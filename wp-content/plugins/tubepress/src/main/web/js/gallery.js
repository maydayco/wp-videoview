var TubePressGallery=(function(h,g,m){var s="tubepress",k=s+".gallery.",e=s+".video.",d=s+".playerlocation.",i=d+"populate",c=d+"invoke",r=k+"load",t=k+"newthumbs",A=k+"pagechange",f=k+"changevideo",n=k+"nextvideo",j=k+"previousvideo",b=e+"start",o=e+"stop",B=m.Beacon,l=B.subscribe,w=B.publish,a=m.Lang.Utils,z=m.Environment,q=m.DomInjector,v="src/main/web/js",x=true,y=false,p=(function(){var R={},O="nvpMap",Q="jsMap",H="page",C="currentVideoId",W="playingNow",X=a.parseIntOrZero,N="playerLocation",aa="embedded",V=B.subscribe,U=function(ak){return a.isDefined(R[ak])},Z=function(ak,am,al){return U(ak)?R[ak][am][al]:null},Y=function(ak){return U(ak)?R[ak][H]:undefined},M=function(ak){return U(ak)?R[ak][C]:undefined},G=function(ak){return Z(ak,Q,"ajaxPagination")},P=function(ak){return Z(ak,Q,"autoNext")},F=function(ak){return U(ak)?R[ak][W]:y},D=function(ak){return Z(ak,Q,"fluidThumbs")},aj=function(ak){return Z(ak,O,aa+"Height")},ai=function(ak){return Z(ak,O,aa+"Width")},af=function(ak){return Z(ak,Q,"httpMethod")},I=function(ak){return R[ak][O]},ab=function(ak){return Z(ak,O,N)},L=function(ak){return Z(ak,Q,N+"JsUrl")},J=function(ak){return Z(ak,Q,N+"ProducesHtml")},T=function(ak){return Z(ak,Q,"sequence")},ag=function(ak){return"#"+s+"_gallery_"+ak+"_thumbnail_area"},ad=function(an,am,ao){var al=a.getParameterByName(s+"_page"),ak=X(al),ap;R[am]=ao;R[am][H]=ak===0?1:ak;R[am][W]=y;ap=T(am);if(ap){R[am][C]=ap[0]}if(G(am)){q.loadJs(v+"/ajaxPagination.js")}},S=function(an,am,al){if(U(am)){var ak=X(al);R[am][H]=ak===0?1:ak}},ac=function(al){var ak;for(ak in R){if(R.hasOwnProperty(ak)){if(al(ak)){return ak}}}return undefined},E=function(al){var ak='[id^="'+al+'"]',am=function(ao){var an=h("#"+s+"_gallery_"+ao);if(!an.length){return false}return an.find(ak).length>0};return ac(am)},ah=function(am,al,ak){var an=E(ak);if(!an){return}R[an][F]=y},ae=function(am,al,ak){var an=E(ak);if(!an){return}R[an][F]=x;R[an][C]=al},K=function(al,ak,am){if(U(ak)){R[ak][C]=am}};V(r,ad);V(A,S);V(f,K);V(o,ah);V(b,ae);return{isAjaxPagination:G,isAutoNext:P,isCurrentlyPlayingVideo:F,isFluidThumbs:D,isRegistered:U,findGalleryContainingVideoDomId:E,getCurrentPageNumber:Y,getCurrentVideoId:M,getEmbeddedHeight:aj,getEmbeddedWidth:ai,getHttpMethod:af,getNvpMap:I,getPlayerLocationName:ab,getPlayerLocationProducesHtml:J,getPlayerLocationJsUrl:L,getSequence:T,getThumbAreaSelector:ag}}()),u=(function(){var C=function(D,E){w(r,[D,E])};return{register:C}}());(function(){var F=Math.floor,E=function(I){return p.getThumbAreaSelector(I)},D=function(I){return h(E(I))},C=function(L){var J=D(L),I=J.find("img:first"),K=120;if(I.length===0){I=J.find("div."+s+"_thumb:first > div."+s+"_embed");if(I.length===0){return K}}K=I.attr("width");if(K){return K}return I.width()},G=function(N){D(N).css({width:"100%"});var L=E(N),P=C(N),J=h(L),O=J.width(),K=F(O/P),M=F(O/K),I=h(L+" div."+s+"_thumb");J.css({width:"100%"});J.css({width:O});I.css({width:M})},H=function(J,I){if(p.isFluidThumbs(I)){G(I)}};l(t+" "+r,H)}());(function(){var E=function(G){return G[3]},C=function(H){var G=H.lastIndexOf("_");return H.substring(16,G)},D=function(){var G=h(this).attr("rel").split("_"),H=E(G),I=C(h(this).attr("id"));w(f,[H,I])},F=function(H,G){h("#"+s+"_gallery_"+G+" a[id^='"+s+"_']").click(D)};l(t+" "+r,F)}());(function(){var C=function(G,E){var F=p.getPlayerLocationJsUrl(E);q.loadJs(F)},D=function(K,O,L){var H=p.getPlayerLocationName(O),N=p.getEmbeddedHeight(O),G=p.getEmbeddedWidth(O),I=p.getNvpMap(O),M=function(R){var P=m.Lang.JsonParser.parse(R.responseText),S=P.title,Q=P.html;w(i,[H,S,Q,N,G,L,O])},J={action:"playerHtml",tubepress_video:L},F=z.getBaseUrl()+"src/main/php/scripts/ajaxEndpoint.php",E;h.extend(J,I);w(c,[H,N,G,L,O]);if(p.getPlayerLocationProducesHtml(O)){E=p.getHttpMethod(O);m.Ajax.Executor.get(E,F,J,M,"json")}};l(r,C);l(f,D)}());(function(){var C=function(E,F){var G=E.data("page");w(A,[F,G])},D=function(F,E){var G=function(){C(h(this),E);if(p.isAjaxPagination(E)){F.preventDefault();return y}return x};h("#"+s+"_gallery_"+E+" div.pagination a").click(G)};l(t+" "+r,D)}());(function(){var C=function(H,G){var J=p.getSequence(G),F=p.getCurrentVideoId(G),E=h.inArray(F.toString(),J),I=J?J.length-1:E;if(E===-1||E===I){return}w(f,[G,J[E+1]])},D=function(H,G){var I=p.getSequence(G),F=p.getCurrentVideoId(G),E=h.inArray(F.toString(),I);if(E===-1||E===0){return}w(f,[G,I[E-1]])};l(n,C);l(j,D)}());(function(){var D=m.Logger,C=function(J,I,H,F,G){var E=p.findGalleryContainingVideoDomId(H);if(!E){return}if(p.isAutoNext(E)&&p.getSequence(E)){if(D.on()){D.log("Auto-starting next for gallery "+E)}B.publish(n,[E])}};B.subscribe(o,C)}());m.AsyncUtil.processQueueCalls("tubePressGalleryRegistrar",u);return{Registry:p}}(jQuery,window,TubePress));